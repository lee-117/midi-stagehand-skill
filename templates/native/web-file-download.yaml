# 文件下载操作模板
# 场景: 触发下载、等待完成和验证下载文件
# 适用平台: Web

engine: native

web:
  url: "https://example.com/downloads"
  headless: false
  viewportWidth: 1280
  viewportHeight: 960

tasks:
  - name: "文件下载验证"
    flow:
      # 配置下载目录
      - javascript: |
          const path = require('path');
          const downloadDir = path.resolve('./midscene-output/downloads');
          const fs = require('fs');
          if (!fs.existsSync(downloadDir)) fs.mkdirSync(downloadDir, { recursive: true });

      - aiWaitFor: "页面加载完成，显示下载链接"
        timeout: 10000

      # 触发下载
      - aiTap: "下载按钮或下载链接"
      - sleep: 5000

      # 验证下载完成
      - javascript: |
          const fs = require('fs');
          const path = require('path');
          const downloadDir = path.resolve('./midscene-output/downloads');
          const files = fs.readdirSync(downloadDir);
          return files.length > 0 ? `下载成功: ${files.join(', ')}` : '未找到下载文件';
        name: "downloadResult"

      - recordToReport: "文件下载测试完成"
        content: "下载结果验证完成"
